<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Studio10 - المستخدمين</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="container">
      <a href="index.html" class="logo">
        <i class="fas fa-cogs"></i>
        Studio10
      </a>
        <nav class="header-nav-icons">
        <a href="index.html" class="active">
          <i class="fas fa-home"></i>
          <span>الرئيسية</span>
        </a>
        <a href="members.html">
          <i class="fas fa-users"></i>
          <span>الأعضاء</span>
        </a>
        <a href="deposit.html">
          <i class="fas fa-wallet"></i>
          <span>إيداع</span>
        </a>
        <a href="withdraw.html">
          <i class="fas fa-university"></i>
          <span>سحب</span>
        </a>
        <a href="reports.html">
          <i class="fas fa-chart-bar"></i>
          <span>تقارير</span>
        </a>
      </nav>

      <div class="header-actions">
        <a href="settings.html" title="الإعدادات"><i class="fas fa-cog"></i></a>
        <a href="users.html" title="المستخدمين"><i class="fas fa-users"></i></a>
        <button onclick="logout()" title="تسجيل الخروج"><i class="fas fa-sign-out-alt"></i></button>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="date-display"></div>

      <section>
        <div class="flex-between mb-20">
          <h2></h2>
          <button class="btn primary" onclick="openModal('addUserModal')">
            <i class="fas fa-plus"></i> إضافة مستخدم
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">
              <i class="fas fa-list"></i> قائمة المستخدمين
            </div>
          </div>
          <div id="users-table-container"></div>
        </div>
      </section>
    </div>
  </main>

  <!-- نافذة إضافة مستخدم -->
  <div id="addUserModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">إضافة مستخدم جديد</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addUserForm">
          <div class="form-group">
            <input type="text" id="userName" placeholder="اسم المستخدم" required>
          </div>
          <div class="form-group">
            <input type="email" id="userEmail" placeholder="البريد الإلكتروني" required>
          </div>
          <div class="form-group">
            <input type="password" id="userPassword" placeholder="كلمة المرور" required>
          </div>
          <div class="form-group">
            <label>الصلاحيات:</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="perm-members" value="members" name="permissions" checked>
                <label for="perm-members">إدارة الأعضاء</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="perm-boxes" value="boxes" name="permissions" checked>
                <label for="perm-boxes">إدارة الصناديق</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="perm-reports" value="reports" name="permissions" checked>
                <label for="perm-reports">عرض التقارير</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="perm-settings" value="settings" name="permissions">
                <label for="perm-settings">الإعدادات</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="perm-users" value="users" name="permissions">
                <label for="perm-users">إدارة المستخدمين</label>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal('addUserModal')">إلغاء</button>
        <button class="btn primary" onclick="submitAddUser()">إضافة</button>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <p>&copy; 2024 Studio10 للأنظمة الإدارية. جميع الحقوق محفوظة.</p>
    </div>
  </footer>

  <script src="script.js"></script>
  <script>
    // إضافة مستخدم
    function submitAddUser() {
      const name = document.getElementById('userName').value;
      const email = document.getElementById('userEmail').value;
      const password = document.getElementById('userPassword').value;
      
      const permCheckboxes = document.querySelectorAll('#addUserForm input[name="permissions"]:checked');
      const permissions = Array.from(permCheckboxes).map(cb => cb.value);
      
      if (!name || !email || !password) {
        showAlert('يرجى ملء جميع الحقول المطلوبة', 'error');
        return;
      }
      
      addUser(name, email, password, permissions);
      document.getElementById('addUserForm').reset();
      closeModal('addUserModal');
      renderUsersTable();
    }

    // إضافة مستخدم للتخزين
    function addUser(name, email, password, permissions) {
      const users = getFromStorage('users', []);
      const newUser = {
        id: Date.now(),
        name: name,
        email: email,
        password: btoa(password), // تشفير بسيط (ليس آمن للإنتاج)
        permissions: permissions,
        createdDate: new Date().toLocaleDateString('ar-SA'),
        status: 'active'
      };
      users.push(newUser);
      saveToStorage('users', users);
      showAlert('تم إضافة المستخدم بنجاح', 'success');
    }

    // الحصول على جميع المستخدمين
    function getAllUsers() {
      return getFromStorage('users', []);
    }

    // حذف مستخدم
    function deleteUser(userId) {
      if (confirm('هل تريد حذف هذا المستخدم؟')) {
        const users = getFromStorage('users', []);
        const filtered = users.filter(u => u.id !== userId);
        saveToStorage('users', filtered);
        showAlert('تم حذف المستخدم بنجاح', 'success');
        renderUsersTable();
      }
    }

    // عرض جدول المستخدمين
    function renderUsersTable() {
      const users = getAllUsers();
      const container = document.getElementById('users-table-container');
      
      if (users.length === 0) {
        container.innerHTML = '<p class="text-center">لا توجد مستخدمين حالياً</p>';
        return;
      }
      
      let html = '<table><thead><tr><th>الاسم</th><th>البريد الإلكتروني</th><th>الصلاحيات</th><th>الحالة</th><th>تاريخ الإنشاء</th><th>الإجراءات</th></tr></thead><tbody>';
      
      users.forEach(user => {
        const permissionsText = user.permissions.join(', ');
        const statusText = user.status === 'active' ? 'نشط' : 'معطل';
        
        html += `
          <tr>
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>${permissionsText}</td>
            <td>${statusText}</td>
            <td>${user.createdDate}</td>
            <td>
              <button class="btn sm" onclick="deleteUser(${user.id})"><i class="fas fa-trash"></i></button>
            </td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      container.innerHTML = html;
    }

    // تحديث الجدول عند التحميل
    document.addEventListener('DOMContentLoaded', function() {
      renderUsersTable();
    });

    function logout() {
      if (confirm('هل تريد تسجيل الخروج؟')) {
        showAlert('تم تسجيل الخروج بنجاح', 'success');
      }
    }
  </script>
</body>
</html>
